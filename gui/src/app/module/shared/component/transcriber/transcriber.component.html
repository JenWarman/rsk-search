<div class="card mb-4">
  <div class="card-body">
    <div class="audio-player">
      <app-audio-player [src]="audioPlayerURL" [playbackRate]="editorConfig.playbackRate || 1.0"
                        #audioPlayer></app-audio-player>
      <div class="mt-3 text-sm text-right">
        <i class="bi-keyboard-fill"></i> Press <span
        class="badge">{{editorConfig?.playPauseKey || 'Insert'}}</span> key to toggle audio playback.
        <span class="badge">{{editorConfig?.rewindKey || 'ScrollLock'}}</span>/<span class="badge">{{editorConfig?.fastForwardKey || 'Pause'}}</span>
        keys to skip backwards/forwards.
        Autoseek is <span class="badge">{{editorConfig?.autoSeek ? 'ON' : 'OFF'}}</span>.
        Audio speed is <span class="badge">{{editorConfig?.playbackRate | number}}</span>.
        Change using the Editor/Audio Config below.
      </div>
    </div>
  </div>
</div>

<div class="alert alert-dark mb-3" *ngIf="fromBackup">Recovered from local backup (you can <a class="btn btn-sm btn-primary" (click)="resetToRaw()">discard</a> the backup to view latest transcript)</div>

<div class="card">
  <div class="card-header">
      <span class="float-right">
        <button class="btn btn-sm" (click)="showHelp = !showHelp"
                [ngClass]="{'btn-outline-primary': !showHelp, 'btn-primary': showHelp}" title="Toggle help text">
          <span *ngIf="!showHelp">I am confused</span>
          <span *ngIf="showHelp">I am satisfied</span>
        </button>
      </span>
    <span class="float-right">
        <button class="btn btn-danger btn-sm mr-3" *ngIf="allowEdit" (click)="resetToRaw()"
                title="revert text to chunk original">Reset</button>
      </span>
    <span class="float-right">
        <app-editor-config #editorConfigModal [initialConfig]="editorConfig"
                           (configUpdated)="handleEditorConfigUpdated($event)"></app-editor-config>
        <button class="btn btn-sm btn-info mr-3" *ngIf="allowEdit" (click)="openEditorConfig()"
                title="Change editor config">Editor/Audio Config</button>
      </span>
    <span>
        <span *ngIf="!isSaved">Create </span>
        <span *ngIf="isSaved">Update </span>
        Draft Transcript
      <span *ngIf="fromBackup">(recovered from local backup)</span>
      </span>
  </div>
  <div [hidden]="showHelp">
    <div class="card-body">
      <app-editor [readonly]="!allowEdit" [wrap]="editorConfig.wrapText" [textContent]="initialTranscript"
                  (textContentChange)="setUpdatedTranscript($event)"
                  (atOffsetMarker)="handleOffsetNavigate($event)"></app-editor>
    </div>
    <div class="card-footer pt-3 pb-3" *ngIf="allowEdit">
      <div class="float-right">
          <span *ngIf="lastUpdateDate" class="text-muted">
            Autosaved {{timeSinceSave()}} ago.
          </span>
        <button *ngIf="isSaved" class="btn btn-sm btn-secondary ml-3" (click)="save()">Save</button>
      </div>
    </div>
  </div>
  <div class="card-body" [hidden]="!showHelp">
    <app-editor-help [editorConfig]="editorConfig"></app-editor-help>
  </div>
</div>
