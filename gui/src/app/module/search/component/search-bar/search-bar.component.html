<div class="search-bar-container" #componentRoot>
  <div class="d-flex">
    <div class="bar flex-grow-1 d-flex p-2">
      <span
        #termsInput
        autofocus
        spellcheck="false"
        contenteditable="true"
        class="term-input flex-grow-1"
        data-ph="Enter search terms, double quote terms for a phrase/exact match. See advanced search options on the right."
        (keydown)="onKeydown($event)"
        (keyup)="onKeyup($event)">
      </span>
      <div class="controls pr-2">
        <i class="bi bi-question-circle clickable" title="Help" (click)="toggleHelp()"></i>
      </div>
    </div>
    <div class="buttons">
      <button class="btn btn-primary" (click)="emitQuery()"><i class="bi-search"></i></button>
    </div>
  </div>
  <div class="search-dropdown p-3 mt-2" *ngIf="caretContainer === 'term' && focusState === 'typing'">
    <app-search-bar-autocomplete
      [termPrefix]="this.getTermText()"
      [keyInput]="keyPress$.asObservable()"
      (temSelected)="setTermAndEmit($event)">
    </app-search-bar-autocomplete>
  </div>
  <div class="search-dropdown p-3 mt-2" *ngIf="caretContainer === 'mention' && focusState === 'typing'">
    <app-search-bar-mention
      [dataFn]="mentionsDataFn"
      [termPrefix]="getAnchorNodeOfCaret().textContent"
      [keyInput]="keyPress$.asObservable()"
      [termTypeIdentifier]="'@'"
      (termSelected)="applyMentionText($event)"
    ></app-search-bar-mention>
  </div>
  <div class="search-dropdown p-3 mt-2" *ngIf="caretContainer === 'publication' && focusState === 'typing'">
    <app-search-bar-mention
      [dataFn]="publicationDataFn"
      [termPrefix]="getAnchorNodeOfCaret().textContent"
      [termTypeIdentifier]="'~'"
      [keyInput]="keyPress$.asObservable()"
      (termSelected)="applyPublicationText($event)"
    ></app-search-bar-mention>
  </div>
  <div class="search-dropdown p-3 mt-2" *ngIf="showHelp">
    <app-search-bar-help></app-search-bar-help>
  </div>
  <div class="search-dropdown p-3 mt-2" *ngIf="showDebugger">
    <div *ngFor="let msg of debug; index as i">{{ msg }}</div>
  </div>
</div>
