<div class="container-fluid pt-3">

  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a [routerLink]="['/search']">Home</a></li>
      <li class="breadcrumb-item active" aria-current="page">{{shortID}}</li>
    </ol>
  </nav>

  <div class="row">
    <div class="col">
      <div class="card" *ngIf="episode">
        <div class="card-header font-weight-bold">{{ shortID }}</div>
        <div class="card-body pb-2">
          <div class="row">
            <div class="col">
              <table class="table m-0">
                <tr>
                  <th style="width: 200px" class="border-top-0">Broadcast</th>
                  <td class="border-top-0">{{episode.releaseDate}}</td>
                </tr>
                <tr>
                  <th>Transcript Data</th>
                  <td><a target="_blank" href="/dl/episode/{{episode.id}}">{{episode.id}}.json</a></td>
                </tr>
                <tr>
                  <th>Transcribers</th>
                  <td>
                    <span *ngIf="episode.metadata['pilkipedia_url']">
                      <a [href]="episode.metadata['pilkipedia_url']" target="_blank">Pilkipedia</a>
                    </span>
                    <span *ngIf="episode.metadata['pilkipedia_url'] && transcribers"> | </span>
                    <span>{{ transcribers }}</span>
                  </td>
                </tr>
              </table>
            </div>
            <div class="col">
              <table class="table m-0">
                <tr>
                  <th style="width: 200px" class="border-top-0">Tags</th>
                  <td class="border-top-0">
                    <a
                      *ngFor="let tag of episode.tags" class="badge badge-info mr-2"
                      [routerLink]="['/search']"
                      [queryParams]='{q: query("content", tag.name)}'>
                      {{tag.kind}}: {{tag.name}}
                    </a>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div *ngIf="episode.synopses && episode.synopses.length > 0">
          <div class="card-header">
            <div class="d-flex">
              <div class="flex-grow-1 font-weight-bold">Synopsis</div>
            </div>
          </div>
          <div class="card-body p-3">
            <ul class="m-0">
              <li *ngFor="let syn of episode?.synopses">
                <!--
                -- todo: Synopsis offsets are wrong somehow
                {{syn.startPos}} - {{syn.endPos}}
                <a *ngIf="syn.startPos > 0" [routerLink]="['/ep', episode?.id]" [fragment]="'pos-'+(syn.startPos)">{{syn.description}}</a>
                <span *ngIf="syn.startPos === undefined || syn.startPos === null">{{syn.description}}</span>
                -->
                <span>{{syn.description}}</span>
              </li>
            </ul>
          </div>
        </div>
        <div *ngIf="quotes && quotes.length > 0">
          <div class="card-header">
            <div class="d-flex">
              <div class="flex-grow-1 font-weight-bold">Quotes</div>
            </div>
          </div>
          <div class="card-body p-3">
            <ul class="m-0">
              <li *ngFor="let quote of quotes">

                <span class="font-italic">"{{quote.content}}" -{{quote.actor}} (<a [routerLink]="['/ep', episode?.id]"
                                                                                   [fragment]="'pos-'+(quote?.pos)">context</a>)</span>
              </li>
            </ul>
          </div>
        </div>
        <div>
          <div class="card-header">
            <div class="d-flex">
              <div class="flex-grow-1 font-weight-bold">Audio</div>
            </div>
          </div>
          <div class="card-body p-3">
            <app-audio-player [src]="audioLink" [playbackRate]="1.0" #audioPlayer></app-audio-player>
            <div class="text-right text-sm mt-2">
              alternatve: <a *ngIf="episode.metadata['spotify_uri']"
                             [href]="episode.metadata['spotify_uri'] | safeUrl"> Tinpotradio (spotify)</a>
            </div>
          </div>
        </div>
        <div class="card-header">
          <div class="d-flex">
            <div class="flex-grow-1 font-weight-bold">
              Transcript
              <span *ngIf="episode.incomplete" class="badge badge-warning ml-3">Incomplete</span>
            </div>
            <div>
              <!-- not fully implemented -->
              <!-- a class="btn btn-sm btn-info" [routerLink]="['/ep', id, 'change']">Submit Correction</a-->
            </div>
          </div>
        </div>
        <div class="card-body p-3">
          <app-transcript
            [transcript]="episode.transcript"
            [scrollToID]="scrollToID"
            [enableLineLinks]="true"
            [enableAudioOffsets]="true"
            (emitAudioTimestamp)="onAudioTimestamp($event)"></app-transcript>
          <div *ngIf="!episode?.transcript?.length" class="text-center p-4">No transcript available.</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container-fluid w-25" *ngIf="error && !episode">
  <div class="row">
    <div class="col">
      <div>
        <div class="card">
          <div class="card-body text-center">
            <div>
              <img src="/assets/illustration/pixeltrue-error-1.svg" style="width: 300px"/>
            </div>
            <div class="pb-2"><strong>{{error}}</strong></div>
            <div>Alright, lets see your little website then. Sick of ya...</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-loading-overlay [loading]="loading"></app-loading-overlay>
